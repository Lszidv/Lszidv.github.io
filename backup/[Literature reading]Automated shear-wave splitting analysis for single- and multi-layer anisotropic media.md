## Abstract

- 剪切波速度各向异性广泛存在于地球内部，并可以通过地震源和接收器之间的剪切波分裂（双折射）进行观测。
**SWSPy**，它能够完全自动化剪切波分裂分析。该软件易于集成到现有的工作流程中，并支持在多层介质中测量各向异性。

- 展示了SWSPy在不同地质环境中的表现，从冰川到地球的地幔。该工具有助于对火山地区的大规模数据集进行解释，并展示了新提出的多层方法在合成数据和实际数据中的应用效果。SWSPy的自动化特性以及对多层各向异性的区分将提升地震各向异性的量化，特别是在层析成像应用中。该方法对于去除各向异性效应也至关重要，尤其在全波形反演和矩震级分析等应用中具有重要意义。

---

## 1.Introduction


### 1. SWSPy简介
SWSPy专门用于剪切波分裂分析，能够准确高效地测量单个地震-接收器射线路径的剪切波速度各向异性。它使用Python编写，易于安装和集成，支持并行化处理。

### 2. 自动化与大规模数据处理
SWSPy设计为完全自动化，能够处理数千个地震事件和接收器的大规模地震数据集。随着地震仪器和数据存储技术的进步，SWSPy可以处理更大规模的数据集，从而增加检测到的地震数量。尽管SWSPy使用Python编写，但其计算密集型部分采用编译语言实现，以提高效率，优化软件性能。

### 3. 支持三维与多层分裂测量
SWSPy支持三维剪切波分裂测量（Walsh等)，并能在某些情况下分析多层剪切波分裂测量，特别适用于复杂地质条件下的研究。

### 4. 与其他软件的对比
SWSPy与现有的其他剪切波分裂分析软件相比具有显著优势。许多现有的软件包，如MFAST（Savage等，2010）和SHEBA（Wuestefeld等，2010），通常要求用户手动输入大量数据，并手动进行数据窗的选择。尽管这些软件包已经在学术界得到广泛应用，但它们通常缺乏自动化处理的能力。SWSPy则通过完全自动化的设计，在处理大规模数据集时大大简化了操作流程。此外，SWSPy的并行化设计可以充分利用现代计算机硬件的优势，进一步提升数据处理能力。与SplitLab、Pytheas等软件相比，SWSPy支持多层剪切波分裂分析，能够更全面地处理复杂的地震数据。

### 5. 软件性能展示
在本研究中，展示了SWSPy的多种应用实例，证明了该软件在大规模数据处理中的实用性和性能。

---
## 2.methods
在各向异性介质中的剪切波分裂可以通过两个主要参数来描述：

- **延迟时间 (δt)**：快S波和慢S波到达之间的时间差；
- **偏振方向 (φ)**：快S波在垂直于传播方向的平面中的偏振方向。

为了测量这些参数，存在多种方法，包括：

1. **互相关法**：通过旋转和平移射线垂直（通常为水平）分量，最大化两者的互相关，来找到最佳的分裂参数。
2. **分裂强度法**：通过接收器处多个地震事件的横向分量的本征向量的方位依赖性来确定分裂参数。该方法要求延迟时间小于剪切波的主周期，并且需要有足够的后方位角覆盖。
3. **特征值法**：通过旋转和平移射线垂直分量，寻找最小的特征值比率，从而确定剪切波分裂参数。该方法在大多数剪切波分裂应用中稳定可靠，并且适用于各种局部到远震的数据。

**SWSPy**软件包采用了**特征值法**，并结合了 **Teanby et al. (2004)** 的多窗口聚类技术和 **Walsh et al. (2013)** 定义的三维坐标系统。特征值法被选为主要方法，因为它在处理不同类型地震数据时表现出良好的稳定性和广泛的适用性。
### 2.1 特征值法在单层介质中的应用

SWSPy中用于测量剪切波分裂的特征值法包括以下步骤（参见图3），针对每个接收器的S波到达，适用于所有地震事件：

1. 加载数据并进行必要的预处理。
2. 将数据旋转到LQT（传播、垂直横向、水平横向）坐标系统。
3. 计算所有可能快方向和延迟时间下的特征值比率 (λ2/λ1)，以获得最佳分裂参数（δt, φ）。
4. 执行聚类分析，寻找对应最小λ2/λ1的最佳分裂参数。
5. 如果需要，计算质量度量 QW (Wuestefeld et al., 2010)。
6. 从剪切波分裂修正的粒子运动中计算S波源的偏振。
7. 将分裂参数结果从LQT坐标系转换为ZNE坐标系。

#### 2.1.1 预处理

数据预处理是分析中的第一步，主要包括以下内容：
1. **去趋势和滤波**：首先对数据进行去趋势处理，去除数据中的趋势成分，然后进行必要的滤波操作，去除噪声，确保S波信号不受影响。
2. **上采样和下采样**：根据原始数据的采样率和计算效率需求，数据可以进行上采样或下采样。上采样提高了延迟时间（δt）测量的精度，但会增加计算成本；下采样则减少了计算成本，但牺牲了一些精度。
3. **上采样方法**：上采样使用加权平均斜率法，这是一种通过加权平均来提高数据采样率的方法。
4. **下采样**：下采样通过减少数据点数来降低计算量，但会降低δt测量的精度，适用于计算资源有限的情况下。
5. **仪器响应的去除**：如果S波信号超出了仪器的常规响应带宽，需要在预处理阶段移除仪器响应，以确保信号分析的准确性。
#### 2.1.2 旋转到LQT坐标系统
- 在剪切波分裂分析中，首先将三分量（ZNE）数据转换为LQT坐标系统。这个过程需要了解射线在接收器处的反方位角和入射角，以便正确地旋转数据。

- Walsh等（2013）提供了一个有用的概述，介绍了本研究中采用的各种坐标系统，帮助更好地理解数据转换的过程。SWSPy软件允许用户选择在ZNE坐标系统中进行测量，且通过将入射角固定为垂直方向的0°，简化了计算。这个假设对于大多数剪切波分裂研究中存在的地质环境是有效的，尤其是当存在多个波长上速度梯度急剧下降的情况时。
#### 2.1.3 寻找最佳分裂参数

一旦数据旋转完成，可以通过网格搜索来找到最佳的剪切波分裂参数δt和φ，以使数据最线性化（能量在偏振（P）平面内最大化，在空位（A）平面内最小化，见图2）即SC91。

对于每一种可能的δt-φ组合，Q(t)和T(t)首先在QT平面内旋转φ角度，然后分别在时间上前后偏移δt/2。接着，构建Q(t)和T(t)的协方差矩阵，并求解该矩阵的特征值。第一和第二特征值的比率（λ2/λ1）描述了QT平面内粒子运动的线性度，较小的比率表示数据的线性度较高。为了最大化解的稳定性，使用λ2/λ1而不是λ1/λ2。

网格搜索是计算量最大的步骤，计算成本取决于δt和φ的分辨率。为了减少计算成本，SWSPy使用了numba编译器，将执行网格搜索的函数转化为机器代码运行，从而加速计算过程。
#### 2.1.4 多窗口稳定性聚类分析

S波相位的窗口选择对结果的稳定性有显著影响。为了找到最稳定的结果，我们实现了Teanby等（2004）的方法，通过改变窗口的开始和结束时间并进行数据聚类，寻找最稳定的结果。这包括对每个窗口在δt-φ空间中重复进行网格搜索。

多个窗口的示例可以在图5a中看到，用户可以指定窗口的持续时间、开始和结束位置，以及窗口组合的数量（如图4和清单1所示）。对于完全自动化的剪切波分裂分析，必须在处理之前指定这些参数，这与非自动化方法中通常为每个事件单独选择这些参数有所不同。用户通过指定以下参数来控制窗口选择：
- **S波到达时间的不确定性/容差**（ta，见图4）；
- **任何窗口开始的最早时间**（tB，见图4）；
- **任何窗口结束的最早时间**（tC，见图4）。

这些参数都是相对于S波相位到达时间定义的，这意味着用户必须提供S波相位到达时间的适当近似值。

每个窗口的最佳分裂参数δt和φ通过DBSCAN聚类算法进行聚类（Ester等，1996）。这与Teanby等（2004）的方法不同，因为我们在新的领域中进行聚类，优化处理了φ的周期性特性。聚类领域C的定义如下：

  $$C = \left( \delta t \cdot \cos(2\phi), \delta t \cdot \sin(2\phi) \right)$$

其中，**δt**是归一化的延迟时间，**φ**是快方向的偏振角度。通过聚类，SWSPy找到每个源接收器对的最优分裂结果，选择具有最小方差的结果。这些方差包括**集群内方差**和**数据方差**，其计算方式如下：

$$sigma^2_{\text{cluster},c} = \frac{1}{N_c} \sum_{n=1}^{N_c} \left( (\delta t_n - \bar{\delta t}_c)^2 + (\phi_n - \bar{\phi}_c)^2 \right)$$

$$sigma^2_{\text{data},c} = \left( \sum_{n=1}^{N_c} \frac{1}{\sigma^2_{\delta t,n}} \right)^{-1} + \left( \sum_{n=1}^{N_c} \frac{1}{\sigma^2_{\phi,n}} \right)^{-1}$$

其中， $N_c$ 是集群 $c$ 中的样本数，  $\bar{\delta t}_c$  和 $\bar{\phi}_c$ 分别是集群 $c$ 的平均值。通过这些计算，SWSPy能够准确地聚类分裂参数并获得最稳定的结果。
![Image](https://github.com/user-attachments/assets/8c549077-7fa1-48df-95cf-5b482f16a873)

#### 2.1.5 自动化处理多个地震源和多个接收器

- Teanby等（2004）的方法结合Silver和Chan（1991）的特征值法，能够为给定的源接收器对提供稳定的剪切波分裂结果。在地震活动研究中，通常涉及数十到数百个接收器和数千到数十万个地震事件，因此，自动化的剪切波分裂结果质量量化方法显得尤为重要。

- SWSPy包含一个类，能够自动计算整个地震目录中的剪切波分裂测量结果。用于量化分裂测量质量的三个指标包括：（1）δt和φ的不确定性（分别为αδt和αφ）；（2）结果的线性度，λ2/λ1，较小的λ2/λ1值表示更好的结果；（3）Wuestefeld质量因子，QW，它衡量特征值法和互相关法之间的结果一致性。

QW值通过以下公式计算：

$$
QW = \{
\begin{matrix}
-(1 - d_{\text{null}}) & \text{当 } d_{\text{null}} < d_{\text{good}} \\
(1 - d_{\text{good}}) & \text{当 } d_{\text{null}} \geq d_{\text{good}}
\end{matrix}
\}
$$

其中，dnull和dgood分别表示较差和较好的测量结果。QW值的高低反映了测量结果的质量，理想结果对应QW = 1，而差的结果则接近零。
#### 2.1.6 S波源偏振

一旦获得最佳的剪切波分裂结果，就可以去除剪切波分裂的影响，恢复地震源辐射出的原始S波。初始的S波源偏振可以通过去除各向异性后的S波粒子运动在QT平面中的特征值来获得。S波源偏振是地震分析中一个有用但未被充分利用的参数，因为对于双偶极地震源，它代表了断层滑动的方向。我们在第3.3节中提供了一个关于如何进行源偏振诊断的示例。

#### 2.1.7 从LQT到ZNE坐标系统的旋转

最后，所有的结果，包括最佳的快方向（φ）、各项质量指标以及S波源的偏振，都将从LQT坐标系统转换到ZNE坐标系统（有关所有相关角度的定义见图2）。因此，结果呈现了一个完整的三维结果，这能够为地震分析提供更详细和全面的信息。

#### 2.2 扩展到多层介质的方法

- 上述方法仅考虑了单层各向异性介质。然而，现实中许多地震波传播过程中可能涉及多个各向异性层，每个层次可能具有不同的快方向和各向异性强度。例如，SKS相位可能穿过地幔层和地壳层，或者源自冰流底部的S波通过具有流动主导的各向异性层传播，并穿越较浅的垂直压缩层（Barruol和Mainprice，1993；Kufner等，2023）。在这种情况下，单层剪切波分裂方法的近似处理将只能得到表观分裂结果，无法区分不同层次的真实物理特性（Silver和Savage，1994）。

- 使用单层方法来近似这些系统，将只能测量到一个表观的剪切波分裂结果，而无法获取每一层的真实分裂参数。这种方法虽然简便，但无法准确描述具有复杂地质结构的多层介质。显然，这种单层近似的局限性会影响分裂结果的准确性，且其修正后的S波到达时间可能没有得到最优线性化。因此，必须采用多层剪切波分裂方法来精确地描述这些复杂的系统，以便提供更多关于介质的信息并优化数据的线性化。为了全面描述这种多层介质，本文中将“两层”与“n层”的剪切波分裂测量方法交替使用。虽然理论上多层问题也可以通过反演更多层的数据来解决，但实际中，观察数据的精度和观测的限制，使得超过两层的反演非常少见。因此，多层分析通常只考虑两层或少数几层的情况。

##### 方法概述：

1. **同时反演两层的方法：**  
   一些学者（Silver和Savage，1994；Özalaybey和Savage，1994；Wolfe和Silver，1998；Reiss和Rümpker，2017）提出了通过同时反演两层剪切波分裂参数的方法。这些方法通过使用多个地震源信号到达同一个接收器，并结合表观分裂参数与每层实际分裂参数之间的理论关系来反演多层的最佳属性。简单来说，这一过程类似于一维层析成像问题，通过组合多个地震源接收器的数据来反演多层介质的结构。

2. **各向异性层析成像方法：**  
   另一种方法是将介质划分成多个箱形域（通常为水平层），每个域都包含完整的各向异性弹性张量，并求解Christoffel方程来计算理论分裂参数。这种方法本质上是一种各向异性层析成像方法，通过反演得到每一层的剪切波分裂参数。与前述同时反演两层的方法相比，这种方法更为稳定，且能够解决更复杂的多层问题，但其一个显著的限制是需要明确指定各向异性层的厚度（Wookey，2012；Hammond等，2014；Kufner等，2023）。

##### 新提出的逐层方法：

- 文中提出的新的逐层测量方法与传统方法不同，它源于独立测量每一对源接收器的各向异性层。此方法逐层处理，从最浅（或最后）一层开始，逐步反演至最深（或第一）层。这种方法能够提高单次测量的精度，并使每层的最优分裂参数获得有效约束。

- 此方法的优点在于它不增加自由度，避免了在多层反演时常见的自由度增加问题。因此，即使是单次测量，也能有效约束结果，避免计算不稳定的情况。虽然这种方法面临必须满足的一些条件，但它允许更高效、更精确地分析每一层的分裂参数。














