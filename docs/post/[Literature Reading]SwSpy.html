<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://avatars.githubusercontent.com/u/160511559?s=400&u=68ec73daff523efd8652079b221d42e446d01cb6&v=4"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="## Abstract

- 剪切波速度各向异性广泛存在于地球内部，并可以通过地震源和接收器之间的剪切波分裂（双折射）进行观测。">
<meta property="og:title" content="[Literature Reading]SwSpy">
<meta property="og:description" content="## Abstract

- 剪切波速度各向异性广泛存在于地球内部，并可以通过地震源和接收器之间的剪切波分裂（双折射）进行观测。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://Lszidv.github.io/post/%5BLiterature%20Reading%5DSwSpy.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/160511559?s=400&u=68ec73daff523efd8652079b221d42e446d01cb6&v=4">
<title>[Literature Reading]SwSpy</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">[Literature Reading]SwSpy</h1>
<div class="title-right">
    <a href="https://Lszidv.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/Lszidv/Lszidv.github.io/issues/33" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h2>Abstract</h2>
<ul>
<li>
<p>剪切波速度各向异性广泛存在于地球内部，并可以通过地震源和接收器之间的剪切波分裂（双折射）进行观测。<br>
<strong>SWSPy</strong>，它能够完全自动化剪切波分裂分析。该软件易于集成到现有的工作流程中，并支持在多层介质中测量各向异性。</p>
</li>
<li>
<p>展示了SWSPy在不同地质环境中的表现，从冰川到地球的地幔。该工具有助于对火山地区的大规模数据集进行解释，并展示了新提出的多层方法在合成数据和实际数据中的应用效果。SWSPy的自动化特性以及对多层各向异性的区分将提升地震各向异性的量化，特别是在层析成像应用中。该方法对于去除各向异性效应也至关重要，尤其在全波形反演和矩震级分析等应用中具有重要意义。</p>
</li>
</ul>
<hr>
<h2>1.Introduction</h2>
<h3>1. SWSPy简介</h3>
<p>SWSPy专门用于剪切波分裂分析，能够准确高效地测量单个地震-接收器射线路径的剪切波速度各向异性。它使用Python编写，易于安装和集成，支持并行化处理。</p>
<h3>2. 自动化与大规模数据处理</h3>
<p>SWSPy设计为完全自动化，能够处理数千个地震事件和接收器的大规模地震数据集。随着地震仪器和数据存储技术的进步，SWSPy可以处理更大规模的数据集，从而增加检测到的地震数量。尽管SWSPy使用Python编写，但其计算密集型部分采用编译语言实现，以提高效率，优化软件性能。</p>
<h3>3. 支持三维与多层分裂测量</h3>
<p>SWSPy支持三维剪切波分裂测量（Walsh等)，并能在某些情况下分析多层剪切波分裂测量，特别适用于复杂地质条件下的研究。</p>
<h3>4. 与其他软件的对比</h3>
<p>SWSPy与现有的其他剪切波分裂分析软件相比具有显著优势。许多现有的软件包，如MFAST（Savage等，2010）和SHEBA（Wuestefeld等，2010），通常要求用户手动输入大量数据，并手动进行数据窗的选择。尽管这些软件包已经在学术界得到广泛应用，但它们通常缺乏自动化处理的能力。SWSPy则通过完全自动化的设计，在处理大规模数据集时大大简化了操作流程。此外，SWSPy的并行化设计可以充分利用现代计算机硬件的优势，进一步提升数据处理能力。与SplitLab、Pytheas等软件相比，SWSPy支持多层剪切波分裂分析，能够更全面地处理复杂的地震数据。</p>
<h3>5. 软件性能展示</h3>
<p>在本研究中，展示了SWSPy的多种应用实例，证明了该软件在大规模数据处理中的实用性和性能。</p>
<hr>
<h2>2.methods</h2>
<p>在各向异性介质中的剪切波分裂可以通过两个主要参数来描述：</p>
<ul>
<li><strong>延迟时间 (δt)</strong>：快S波和慢S波到达之间的时间差；</li>
<li><strong>偏振方向 (φ)</strong>：快S波在垂直于传播方向的平面中的偏振方向。</li>
</ul>
<p>为了测量这些参数，存在多种方法，包括：</p>
<ol>
<li><strong>互相关法</strong>：通过旋转和平移射线垂直（通常为水平）分量，最大化两者的互相关，来找到最佳的分裂参数。</li>
<li><strong>分裂强度法</strong>：通过接收器处多个地震事件的横向分量的本征向量的方位依赖性来确定分裂参数。该方法要求延迟时间小于剪切波的主周期，并且需要有足够的后方位角覆盖。</li>
<li><strong>特征值法</strong>：通过旋转和平移射线垂直分量，寻找最小的特征值比率，从而确定剪切波分裂参数。该方法在大多数剪切波分裂应用中稳定可靠，并且适用于各种局部到远震的数据。</li>
</ol>
<p><strong>SWSPy</strong>软件包采用了<strong>特征值法</strong>，并结合了 <strong>Teanby et al. (2004)</strong> 的多窗口聚类技术和 <strong>Walsh et al. (2013)</strong> 定义的三维坐标系统。特征值法被选为主要方法，因为它在处理不同类型地震数据时表现出良好的稳定性和广泛的适用性。</p>
<h3>2.1 特征值法在单层介质中的应用</h3>
<p>SWSPy中用于测量剪切波分裂的特征值法包括以下步骤（参见图3），针对每个接收器的S波到达，适用于所有地震事件：</p>
<ol>
<li>加载数据并进行必要的预处理。</li>
<li>将数据旋转到LQT（传播、垂直横向、水平横向）坐标系统。</li>
<li>计算所有可能快方向和延迟时间下的特征值比率 (λ2/λ1)，以获得最佳分裂参数（δt, φ）。</li>
<li>执行聚类分析，寻找对应最小λ2/λ1的最佳分裂参数。</li>
<li>如果需要，计算质量度量 QW (Wuestefeld et al., 2010)。</li>
<li>从剪切波分裂修正的粒子运动中计算S波源的偏振。</li>
<li>将分裂参数结果从LQT坐标系转换为ZNE坐标系。</li>
</ol>
<h4>2.1.1 预处理</h4>
<p>数据预处理是分析中的第一步，主要包括以下内容：</p>
<ol>
<li><strong>去趋势和滤波</strong>：首先对数据进行去趋势处理，去除数据中的趋势成分，然后进行必要的滤波操作，去除噪声，确保S波信号不受影响。</li>
<li><strong>上采样和下采样</strong>：根据原始数据的采样率和计算效率需求，数据可以进行上采样或下采样。上采样提高了延迟时间（δt）测量的精度，但会增加计算成本；下采样则减少了计算成本，但牺牲了一些精度。</li>
<li><strong>上采样方法</strong>：上采样使用加权平均斜率法，这是一种通过加权平均来提高数据采样率的方法。</li>
<li><strong>下采样</strong>：下采样通过减少数据点数来降低计算量，但会降低δt测量的精度，适用于计算资源有限的情况下。</li>
<li><strong>仪器响应的去除</strong>：如果S波信号超出了仪器的常规响应带宽，需要在预处理阶段移除仪器响应，以确保信号分析的准确性。</li>
</ol>
<h4>2.1.2 旋转到LQT坐标系统</h4>
<ul>
<li>
<p>在剪切波分裂分析中，首先将三分量（ZNE）数据转换为LQT坐标系统。这个过程需要了解射线在接收器处的反方位角和入射角，以便正确地旋转数据。</p>
</li>
<li>
<p>Walsh等（2013）提供了一个有用的概述，介绍了本研究中采用的各种坐标系统，帮助更好地理解数据转换的过程。SWSPy软件允许用户选择在ZNE坐标系统中进行测量，且通过将入射角固定为垂直方向的0°，简化了计算。这个假设对于大多数剪切波分裂研究中存在的地质环境是有效的，尤其是当存在多个波长上速度梯度急剧下降的情况时。</p>
</li>
</ul>
<h4>2.1.3 寻找最佳分裂参数</h4>
<p>一旦数据旋转完成，可以通过网格搜索来找到最佳的剪切波分裂参数δt和φ，以使数据最线性化（能量在偏振（P）平面内最大化，在空位（A）平面内最小化，见图2）即SC91。</p>
<p>对于每一种可能的δt-φ组合，Q(t)和T(t)首先在QT平面内旋转φ角度，然后分别在时间上前后偏移δt/2。接着，构建Q(t)和T(t)的协方差矩阵，并求解该矩阵的特征值。第一和第二特征值的比率（λ2/λ1）描述了QT平面内粒子运动的线性度，较小的比率表示数据的线性度较高。为了最大化解的稳定性，使用λ2/λ1而不是λ1/λ2。</p>
<p>网格搜索是计算量最大的步骤，计算成本取决于δt和φ的分辨率。为了减少计算成本，SWSPy使用了numba编译器，将执行网格搜索的函数转化为机器代码运行，从而加速计算过程。</p>
<h4>2.1.4 多窗口稳定性聚类分析</h4>
<p>S波相位的窗口选择对结果的稳定性有显著影响。为了找到最稳定的结果，我们实现了Teanby等（2004）的方法，通过改变窗口的开始和结束时间并进行数据聚类，寻找最稳定的结果。这包括对每个窗口在δt-φ空间中重复进行网格搜索。</p>
<p>多个窗口的示例可以在图5a中看到，用户可以指定窗口的持续时间、开始和结束位置，以及窗口组合的数量（如图4和清单1所示）。对于完全自动化的剪切波分裂分析，必须在处理之前指定这些参数，这与非自动化方法中通常为每个事件单独选择这些参数有所不同。用户通过指定以下参数来控制窗口选择：</p>
<ul>
<li><strong>S波到达时间的不确定性/容差</strong>（ta，见图4）；</li>
<li><strong>任何窗口开始的最早时间</strong>（tB，见图4）；</li>
<li><strong>任何窗口结束的最早时间</strong>（tC，见图4）。</li>
</ul>
<p>这些参数都是相对于S波相位到达时间定义的，这意味着用户必须提供S波相位到达时间的适当近似值。</p>
<p>每个窗口的最佳分裂参数δt和φ通过DBSCAN聚类算法进行聚类（Ester等，1996）。这与Teanby等（2004）的方法不同，因为我们在新的领域中进行聚类，优化处理了φ的周期性特性。聚类领域C的定义如下：</p>
<p>$$C = \left( \delta t \cdot \cos(2\phi), \delta t \cdot \sin(2\phi) \right)$$</p>
<p>其中，<strong>δt</strong>是归一化的延迟时间，<strong>φ</strong>是快方向的偏振角度。通过聚类，SWSPy找到每个源接收器对的最优分裂结果，选择具有最小方差的结果。这些方差包括<strong>集群内方差</strong>和<strong>数据方差</strong>，其计算方式如下：</p>
<p>$$sigma^2_{\text{cluster},c} = \frac{1}{N_c} \sum_{n=1}^{N_c} \left( (\delta t_n - \bar{\delta t}_c)^2 + (\phi_n - \bar{\phi}_c)^2 \right)$$</p>
<p>$$sigma^2_{\text{data},c} = \left( \sum_{n=1}^{N_c} \frac{1}{\sigma^2_{\delta t,n}} \right)^{-1} + \left( \sum_{n=1}^{N_c} \frac{1}{\sigma^2_{\phi,n}} \right)^{-1}$$</p>
<p>其中， $N_c$ 是集群 $c$ 中的样本数，  $\bar{\delta t}_c$  和 $\bar{\phi}_c$ 分别是集群 $c$ 的平均值。通过这些计算，SWSPy能够准确地聚类分裂参数并获得最稳定的结果。<br>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/8c549077-7fa1-48df-95cf-5b482f16a873"><img src="https://github.com/user-attachments/assets/8c549077-7fa1-48df-95cf-5b482f16a873" alt="Image" style="max-width: 100%;"></a></p>
<h4>2.1.5 自动化处理多个地震源和多个接收器</h4>
<ul>
<li>
<p>Teanby等（2004）的方法结合Silver和Chan（1991）的特征值法，能够为给定的源接收器对提供稳定的剪切波分裂结果。在地震活动研究中，通常涉及数十到数百个接收器和数千到数十万个地震事件，因此，自动化的剪切波分裂结果质量量化方法显得尤为重要。</p>
</li>
<li>
<p>SWSPy包含一个类，能够自动计算整个地震目录中的剪切波分裂测量结果。用于量化分裂测量质量的三个指标包括：（1）δt和φ的不确定性（分别为αδt和αφ）；（2）结果的线性度，λ2/λ1，较小的λ2/λ1值表示更好的结果；（3）Wuestefeld质量因子，QW，它衡量特征值法和互相关法之间的结果一致性。</p>
</li>
</ul>
<p>QW值通过以下公式计算：</p>
<p>$$
QW = {
\begin{matrix}
-(1 - d_{\text{null}}) &amp; \text{当 } d_{\text{null}} &lt; d_{\text{good}} \\
(1 - d_{\text{good}}) &amp; \text{当 } d_{\text{null}} \geq d_{\text{good}}
\end{matrix}
}
$$</p>
<p>其中，dnull和dgood分别表示较差和较好的测量结果。QW值的高低反映了测量结果的质量，理想结果对应QW = 1，而差的结果则接近零。</p>
<h4>2.1.6 S波源偏振</h4>
<p>一旦获得最佳的剪切波分裂结果，就可以去除剪切波分裂的影响，恢复地震源辐射出的原始S波。初始的S波源偏振可以通过去除各向异性后的S波粒子运动在QT平面中的特征值来获得。S波源偏振是地震分析中一个有用但未被充分利用的参数，因为对于双偶极地震源，它代表了断层滑动的方向。我们在第3.3节中提供了一个关于如何进行源偏振诊断的示例。</p>
<h4>2.1.7 从LQT到ZNE坐标系统的旋转</h4>
<p>最后，所有的结果，包括最佳的快方向（φ）、各项质量指标以及S波源的偏振，都将从LQT坐标系统转换到ZNE坐标系统（有关所有相关角度的定义见图2）。因此，结果呈现了一个完整的三维结果，这能够为地震分析提供更详细和全面的信息。</p>
<h4>2.2 扩展到多层介质的方法</h4>
<ul>
<li>
<p>上述方法仅考虑了单层各向异性介质。然而，现实中许多地震波传播过程中可能涉及多个各向异性层，每个层次可能具有不同的快方向和各向异性强度。例如，SKS相位可能穿过地幔层和地壳层，或者源自冰流底部的S波通过具有流动主导的各向异性层传播，并穿越较浅的垂直压缩层（Barruol和Mainprice，1993；Kufner等，2023）。在这种情况下，单层剪切波分裂方法的近似处理将只能得到表观分裂结果，无法区分不同层次的真实物理特性（Silver和Savage，1994）。</p>
</li>
<li>
<p>使用单层方法来近似这些系统，将只能测量到一个表观的剪切波分裂结果，而无法获取每一层的真实分裂参数。这种方法虽然简便，但无法准确描述具有复杂地质结构的多层介质。显然，这种单层近似的局限性会影响分裂结果的准确性，且其修正后的S波到达时间可能没有得到最优线性化。因此，必须采用多层剪切波分裂方法来精确地描述这些复杂的系统，以便提供更多关于介质的信息并优化数据的线性化。为了全面描述这种多层介质，本文中将“两层”与“n层”的剪切波分裂测量方法交替使用。虽然理论上多层问题也可以通过反演更多层的数据来解决，但实际中，观察数据的精度和观测的限制，使得超过两层的反演非常少见。因此，多层分析通常只考虑两层或少数几层的情况。</p>
</li>
</ul>
<h5>方法概述：</h5>
<ol>
<li>
<p><strong>同时反演两层的方法：</strong><br>
一些学者（Silver和Savage，1994；Özalaybey和Savage，1994；Wolfe和Silver，1998；Reiss和Rümpker，2017）提出了通过同时反演两层剪切波分裂参数的方法。这些方法通过使用多个地震源信号到达同一个接收器，并结合表观分裂参数与每层实际分裂参数之间的理论关系来反演多层的最佳属性。简单来说，这一过程类似于一维层析成像问题，通过组合多个地震源接收器的数据来反演多层介质的结构。</p>
</li>
<li>
<p><strong>各向异性层析成像方法：</strong><br>
另一种方法是将介质划分成多个箱形域（通常为水平层），每个域都包含完整的各向异性弹性张量，并求解Christoffel方程来计算理论分裂参数。这种方法本质上是一种各向异性层析成像方法，通过反演得到每一层的剪切波分裂参数。与前述同时反演两层的方法相比，这种方法更为稳定，且能够解决更复杂的多层问题，但其一个显著的限制是需要明确指定各向异性层的厚度（Wookey，2012；Hammond等，2014；Kufner等，2023）。</p>
</li>
</ol>
<h5>新提出的逐层方法：</h5>
<ul>
<li>
<p>文中提出的新的逐层测量方法与传统方法不同，它源于独立测量每一对源接收器的各向异性层。此方法逐层处理，从最浅（或最后）一层开始，逐步反演至最深（或第一）层。这种方法能够提高单次测量的精度，并使每层的最优分裂参数获得有效约束。</p>
</li>
<li>
<p>此方法的优点在于它不增加自由度，避免了在多层反演时常见的自由度增加问题。因此，即使是单次测量，也能有效约束结果，避免计算不稳定的情况。虽然这种方法面临必须满足的一些条件，但它允许更高效、更精确地分析每一层的分裂参数。</p>
</li>
</ul>
<h4>2.2.1 逐层方法所需假设</h4>
<ol>
<li>n层将S波分裂n次（Yardley和Crampin，1991；Silver和Savage，1994）。</li>
<li>每层具有单一的有效各向异性。这意味着该方法只能解析给定层内所有各向异性贡献的整体效果，类似于单层方法。</li>
<li>最深层（层1）的延迟时间（δt1）必须大于S波的最长主导周期成分（参见Rümpker和Silver（1998b），图1，展示了频率与延迟时间效应的关系）。</li>
<li>初始表观单层测量中占主导地位的信号来自第一层分裂。这个假设对于大多数情况有效，因为第一层仅在快波和慢波之间分配能量。</li>
<li>每层的各向异性具有相同的频率依赖性行为，即S波在不同层中的散射行为是相同的。</li>
<li>每层的快方向（φ1，φ2，...，φn）在QT平面中不平行或正交。如果它们是正交的，则无法区分来自两个层的相位，因为快波和慢波不会进一步分裂，导致其中一个层的结果为零（零结果意味着各向异性不可区分）。</li>
</ol>
<p>尽管这些条件看起来很严格，但在实际的物理场景中，许多情况可能满足这些假设，因此该方法在实际应用中具有潜力。</p>
<h4>2.2.2 两层的分裂方法</h4>
<p>多层分裂方法测量每一层的分裂参数（φi，δti），同时使用单层方法测量表观分裂参数（φapp，δtapp），以便量化多层结果相对于单层结果的显著性。这些参数的测量过程如下：</p>
<ol>
<li>使用单层方法测量表观分裂参数，对于包含所有S波能量的窗口wininit进行测量（见第2.1节）。</li>
<li>初始窗口被分成两个子窗口，一个从twininit,start到twininit,start+δtapp，另一个从twininit,start+δtapp到twininit,end，由表观延迟时间δtapp控制。</li>
<li>对这些子窗口使用特征值法（见第2.1节）分别测量分裂参数，最线性化的结果（最小的λ2/λ1）定义为最浅层（对于两层问题是层2）的最优分裂参数。</li>
<li>然后对整个窗口wininit中的S波到达时间进行修正，去除层2的分裂影响。</li>
<li>使用修正后的数据，在整个窗口wininit中再次测量分裂参数，得到最深层（层1）的分裂参数。</li>
<li>最后，可以确认两层解决方案是否比单层表观解决方案更准确地描述了介质。这里我们定义多层结果更为准确的条件是：（1）更线性（即（λ2/λ1）multi-layer &lt; （λ2/λ1）single-layer）；（2）两层的快方向具有不同的方向，经过不确定性修正后。</li>
</ol>
<p>多层结果的线性度（λ2/λ1）multi-layer通过对每一层的λ2/λ1值进行求和来量化：</p>
<p>$$
(λ2/λ1)multi-layer = \sum_{n=1}^n \left( \frac{λ2}{λ1} \right)_n,
$$</p>
<p>其中，n表示第n层。</p>
<h4>2.2.3 扩展到n层</h4>
<p>第2.2.2节特地为清晰起见，描述了两层的多层方法。然而，将该方法扩展到n层在理论上是非常简单的。第2到第4步可以通过连续的小窗口重复进行，使用δt2,app, δt3,app, ..., δtn,app来划分每个窗口。然而，实际上可以独立测量的层数是有限的。</p>
<ul>
<li>随着需要反演的层数增加，各种S波相位到达时间更有可能彼此难以区分，因为每层变得更薄，这不可避免地导致延迟时间变小。此外，窗口长度也会变得更小，从而导致较不稳定的解。每一层的分裂导致的能量划分会使S波振幅减少1/2^n，从而降低每个单独S波相位到达的信噪比（SNR）。因此，尽管为了完整性考虑了扩展到n层的情况，但仅提供最多解决两层的例子，因为对于更多层的反演，信号的稳定性和精度难以保证。</li>
</ul>
<h3>2.3 SWSPy使用示例</h3>
<p>SWSPy支持从简单的单一源接收器对到多个接收器和多个源的剪切波分裂自动测量。提供了一个简单的例子，展示如何在多个接收器上测量单一源的剪切波分裂，以及如何进行正演模拟，生成具有剪切波分裂的合成信号。</p>
<h4>2.3.1 测量地震剪切波分裂</h4>
<p>SWSPy使用基于Python类的结构实现（见Listing 1），并广泛利用obspy进行地震数据的输入和输出（Krischer等，2015）。通过传入一个包含所有接收器数据流的obspy数据，创建一个<code class="notranslate">splittingObject</code>，并可以指定窗口和参数搜索空间来执行剪切波分裂分析。</p>
<p>Listing 1展示了如何使用<code class="notranslate">splittingObject</code>来执行剪切波分裂分析：</p>
<pre class="notranslate"><code class="notranslate">import swspy, obspy
# 创建剪切波分裂对象：
st = obspy.read(&lt;数据路径&gt;)
splittingObject = swspy.splitting.create_splitting_object(st)
# 指定一些关键参数...
splittingObject.win_S_pick_tolerance = 0.1
splittingObject.overall_win_start_pre_fast_S_pick = 0.3
splittingObject.overall_win_start_post_fast_S_pick = 0.2
splittingObject.max_t_shift_s = 1.0
# 执行分裂分析：
splittingObject.perform_sws_analysis(coord_system=‘‘ZNE’’, sws_method=‘‘EV’’)
# 绘制并保存结果：
# （将splittingObject.sws_result_df保存为csv文件）
splittingObject.plot()
splittingObject.save_result()
</code></pre>
<h4>2.3.2 正演模拟</h4>
<p>SWSPy还支持正演模拟，用于生成通过各向异性介质传播的合成地震波形。Listing 2展示了一个示例，如何生成一个主频为10 Hz的S波合成地震波形，传播通过一个具有60°快方向和δt = 0.5 s的层。</p>
<p>这种正演模拟功能可用于验证SWSPy的性能，并解决反演问题。以下是一个使用正演模拟生成合成地震波形的代码示例：</p>
<pre class="notranslate"><code class="notranslate">import swspy
# 创建源时函数：
seismogram_dur_s = 10.0
sampling_rate_hz = 1000.0
st = swspy.splitting.forward_model.create_src_time_func(seismogram_dur_s, sampling_rate_hz)
# 指定层的各向异性参数：
phi_from_N = 60
dt = 0.5
back_azi = 0
event_inclin_angle_at_station = 0
# 应用分裂：
st = swspy.splitting.forward_model.add_splitting(st, phi_from_N, dt, back_azi, event_inclin_angle_at_station)
</code></pre>
<h2>3 Examples</h2>
<h3>3.1 简单的冰震示例</h3>
<p>在此，我们以冰川上的实际地震为例，展示如何使用SWSPy进行S波分裂分析，特别关注指示可靠测量的关键特征。图5展示了来自南极鲁特福德冰流的单个接收器处的冰震基底粘滑S波到达（Hudson等，2020a；Smith等，2015）。</p>
<p>冰川冰体具有强烈的各向异性结构，结合南极地区的低噪声水平，为S波分裂提供了一个理想的实际案例（Smith等，2017；Harland等，2013；Kufner等，2023）。基底粘滑冰震也提供了理想的例子，因为它们的S波源极化通常受到良好约束，通常与冰流方向大致对齐（相对于北方160°，Smith等，2015），在本例中，通过全波形源机制反演得到了确认（Hudson等，2020a）。<br>
以下是用于量化剪切波分裂结果质量的几个关键特征：</p>
<ol>
<li>
<p><strong>检查ZNE坐标系中的原始波形与去除分裂后的波形</strong>（见图5a）。</p>
<ul>
<li>S波到达波包应位于可能窗口的起始和结束之间（灰色垂直线）。</li>
<li>去除分裂后的波包应比原始数据波包更短。</li>
</ul>
</li>
<li>
<p><strong>最大化和最小化去除分裂后的P和A分量能量</strong>（图5b）。</p>
<ul>
<li>P分量与A分量的振幅比表示去除分裂后粒子运动的线性度，较小的λ2/λ1值表示更线性的结果。</li>
<li>对于冰震，λ2/λ1 = 0.033，大部分能量集中在P分量，仅有少量能量到达A分量。</li>
</ul>
</li>
<li>
<p><strong>快慢S波相位到达的时间应不同</strong>，去除分裂后时间应对齐（见图5c右面板）。</p>
<ul>
<li>快慢S波相位应在去除分裂前到达不同的时间，去除分裂后应对齐。</li>
</ul>
</li>
<li>
<p><strong>在东北平面上大致线性的粒子运动</strong>（见图5d）。</p>
<ul>
<li>对于冰震，粒子运动大致线性，源极化大约为从北方165° ± 6°，与冰流方向一致。</li>
</ul>
</li>
<li>
<p><strong>检查聚类分析的稳定性</strong>（见图5e）。</p>
<ul>
<li>聚类样本应有小的不确定性，从而得到稳定的φ和δt解。</li>
<li>如果样本显示明显的非均匀行为，结果可能受到周期跳跃等效应的影响。</li>
</ul>
</li>
<li>
<p><strong>在φ−δt空间内特征值比呈现明显的最小值</strong>（见图5f）。</p>
<ul>
<li>冰震展示了明显的单一全局最小值，最优解由绿色点及其误差条表示。</li>
<li>φ−δt空间图有助于检查周期跳跃是否发生。如果周期跳跃占主导，可能会看到多个最小值，并且这些最小值对应的φ值相隔90°。</li>
</ul>
</li>
<li>
<p><strong>测量质量参数λ2/λ1和QW</strong>。</p>
<ul>
<li>SWSPy可以输出多个质量参数，λ2/λ1表示结果的线性度。</li>
<li>SWSPy还计算Wuestefeld质量因子QW，QW = 1表示良好结果，QW = 0表示较差结果，QW = −1表示零结果。</li>
<li>对于冰震，QW = 0.969，确认了特征值法和交叉相关方法得到的一致结果。<br>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/921092bb-0486-4ba8-ba67-bb95d3a66d96"><img src="https://github.com/user-attachments/assets/921092bb-0486-4ba8-ba67-bb95d3a66d96" alt="Image" style="max-width: 100%;"></a></li>
</ul>
</li>
</ol>
<h3>3.2 远震剪切波分裂</h3>
<p>本节展示了SWSPy在远震剪切波分裂中的表现。远震剪切波分裂技术，特别是SKS、PKS和SKKS相位分析，是用于约束上地幔变形模式的常用方法。由于这些相位的近垂直入射角和由P波转化为S波导致的径向极化，使得它们能提供可靠的地幔剪切波分裂测量。</p>
<p>图6展示了2005年2月5日Mw7.1级Celebus海地震的数据，记录于美国加利福尼亚NEE站。使用SHEBA代码进行的剪切波分裂分析发现了SKS和SKKS的剪切波分裂不一致，其中SKS为零结果，而SKKS则表现出明显的剪切波分裂，得到了φ = 74° ± 5°，δt = 1.05 ± 0.07秒的结果。</p>
<p>使用SWSPy重新测量SKKS相位的剪切波分裂，得到了φ = 74.2° ± 14.0°，δt = 1.05 ± 0.175秒，与SHEBA结果一致。我们还能够获取源极化为115° ± 7°，与SHEBA的测量值115°以及观察到的背方位角294°一致，符合SKS径向极化的假设。</p>
<p>这个示例仅展示了一个简单的远震应用，实际中的远震剪切波分裂研究，特别是针对最下层地幔的研究，更加复杂。现代远震剪切波分裂研究采用堆叠和波束形成等预处理方法，有助于在噪声较大的数据集中识别SKS、SKKS和S3KS相位。</p>
<h3>3.3 自动化S波分裂分析在火山中多个地震中的应用</h3>
<ul>
<li>
<p>本节展示了如何使用SWSPy进行火山中多个地震的自动化S波分裂分析。随着仪器灵敏度和密度的提高，以及计算技术的发展，现今可以处理包含成千上万次地震事件的大型地震目录，为更高分辨率的S波速度各向异性研究提供了机会。</p>
</li>
<li>
<p>图7展示了在玻利维亚乌图伦库火山上进行的1356次地震的结果。该地震目录来源于完全自动化的检测算法。图7a显示了所有源接收器对的快S波极化的未经滤波分布，并与数据的过滤子集进行了比较。经过滤波的子集包含约束良好的测量结果，这些结果具有较小的不确定性，并表现出一个主导的各向异性方向，呈SE-NW方向。</p>
</li>
<li>
<p>为了验证这些快方向是否确实代表了裂缝结构，将结果与独立测量的断层走向数据进行了对比，发现快方向与断层走向平行。乌图伦库火山的衰减层析成像表明，流体主要存在于具有这种取向的断层中，受火山区域应力场的控制。</p>
</li>
<li>
<p>这些S波各向异性结果与独立观测结果一致，验证了自动化S波分裂方法的有效性。</p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/e3d09148-d5e1-44b8-843a-8293df006e02"><img src="https://github.com/user-attachments/assets/e3d09148-d5e1-44b8-843a-8293df006e02" alt="Image" style="max-width: 100%;"></a></p>
<h3>多层介质示例</h3>
<h4>3.4.1 正演模型示例</h4>
<p>我们首先在模拟数据上展示新多层分裂方法的表现，然后再将其应用于真实案例。图8展示了一个两层正演模型的结果。剪切波分裂应用于中心频率为10 Hz、源极化方向为0° N的Ricker小波上两次，模拟波传播通过两层介质（φ层1 = 60°，φ层2 = 40°，δt层1 = 0.5秒，δt层2 = 0.2秒）。</p>
<p>图8a-d展示的表观剪切波分裂测量明显无法找到真实结果。然而，φ−δt空间显示表观测量对两个层次都敏感，并且在δt = 0.2秒和δt = 0.5秒处有明显的最小值。第一层表现出较强的分裂信号，因此该层主导了解析。由于周期跳跃的影响，在φ−δt空间中为每一层选择最小值变得具有挑战性。</p>
<p>通过新的层-by-层分裂测量方法，成功解析了两层的各向异性，所有结果都接近真实值，并且大多数结果与真实值在不确定性范围内一致。修正后的波形进一步验证了新方法的性能。</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/ff099ab4-d9f8-493b-8a5f-ff9721fdb2f4"><img src="https://github.com/user-attachments/assets/ff099ab4-d9f8-493b-8a5f-ff9721fdb2f4" alt="Image" style="max-width: 100%;"></a><br>
a-d部分：展示了表观的单层测量结果，包括合成的地震波形和分裂参数的估计。<br>
e-h部分：展示了逐层反演的结果，其中g图中的蓝色数据表示仅对第二层进行中间校正后的粒子运动。</p>
<h4>3.4.2 冰震示例</h4>
<p>成功的多层S波速度各向异性测量在现实世界中的例子较少，这主要是因为测量多层分裂的挑战，而非缺乏多层各向异性介质。然而，冰川冰为多层各向异性提供了一个现实的例子。</p>
<p>图9展示了两层S波分裂结果的水平粒子运动，并与图5中的单层结果进行了对比。结果表明，两层模型比单层模型提供了更好的线性化效果，特征值比λ2/λ1表明，两层结果的线性化程度大约是单层结果的两倍。这证明了两层介质比单层介质更能准确描述观测结果。</p>
<p>修正后的波形进一步验证了我们新方法的表现，结果显示两层介质能够有效地解析冰震中的各向异性，而不是仅仅依靠额外的自由度进行拟合。尽管多层分裂分析提供了更多自由度，但需要小心避免过拟合，尤其是在连续层的快方向一致时。</p>
<h4>3.4.3 多层S波分裂的挑战和局限性</h4>
<ul>
<li>
<p>尽管本研究中提出的多层方法在合成示例和冰震示例中表现良好，但由于所需的假设，这种方法对于那些信号频率相对较低的情况存在局限性。特别是对于大多数远震剪切波分裂分析或任何情况下，其中δt小于S波的主周期，并且地壳层的δt可能大于地幔中的分裂幅度，该方法可能不适用。</p>
</li>
<li>
<p>图10展示了这个问题的例子。通过将剪切波分裂分析应用于具有类似SKS相位到达特征的合成地震图，我们观察到，表观单层测量和多层测量均能比原始未修正波形产生更线性化的修正S波到达时间。然而，表观单层测量无法正确解析各向异性，而多层测量虽然解析了第一层，但第二层的快方向未能解析，并且与合成层值相差90°。这一问题源自于表观分裂参数之间的周期性关系，这导致了在给定层的快方向（φi）上的非唯一解，尤其在δt &gt; 1/2f时进一步引入了不确定性。</p>
</li>
<li>
<p>Özalaybey和Savage（1994）通过结合多个方位的SKS相位数据来解决此类非唯一解问题，类似的方法也被其他研究者采用。虽然SWSPy没有实现这种算法，但它可以作为多事件反演工作流程的一部分，在反演之前测量表观分裂参数。</p>
</li>
</ul>
<p>因此，尽管多层分裂分析方法展现了潜力，但在实际应用中仍然面临周期跳跃和非唯一解等挑战，使用时需要小心处理。</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/237ac071-80c9-4330-a53a-d25d55c0311f"><img src="https://github.com/user-attachments/assets/237ac071-80c9-4330-a53a-d25d55c0311f" alt="Image" style="max-width: 100%;"></a></p>
<h3>3.5 SWSPy与其他剪切波分裂软件包的比较</h3>
<ul>
<li>
<p>为了完整性，比较了SWSPy在本研究中两个主要极端事件的结果，分别是图5中的冰震和图6中的SKKS到达。SWSPy与MFAST（Savage等，2010）和SHEBA（Wuestefeld等，2010）的比较结果见表1。我们没有包括SplitRacer（Reiss和Rümpker，2017）和Pytheas（Spingos等，2020）的结果，因为这些是图形用户界面，适用性与我们的实现方式有显著差异。</p>
</li>
<li>
<p>所有分裂测量都使用尽可能相似的参数进行，包括滤波属性、数据持续时间和用于聚类的窗口数量。三个软件包在不确定范围内得到相同的快方向（φ）和延迟时间（δt）。SWSPy的误差较大，因为我们故意采用比其他软件包更保守的估计方法。这在表1中的SKKS示例中尤为明显。尽管如此，误差仍然仅占结果的一小部分。</p>
</li>
<li>
<p>这些软件包的差异主要体现在源极化方向上，SWSPy和SHEBA一致，而MFAST则存在显著差异。考虑到SWSPy与SHEBA几乎一致的表现，并且源极化方向的测量与物理设置一致，我们有信心认为SWSPy的源极化估计是现实的。</p>
</li>
<li>
<p>我们没有将SWSPy与这些其他方法在计算时间上的表现进行基准测试，因为SWSPy是并行化的，而SHEBA和MFAST则不是。考虑到现代计算机的能力，大多数用户很可能会利用SWSPy的并行化特性，这将迅速弥补SWSPy相对于其他软件包的任何低效之处。</p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/13a3df5b-dcfa-4889-b8a3-67f00266f40d"><img src="https://github.com/user-attachments/assets/13a3df5b-dcfa-4889-b8a3-67f00266f40d" alt="Image" style="max-width: 100%;"></a></p>
<h2>4Disscussion</h2>
<h3>4.1 优势与局限性</h3>
<ul>
<li>
<p>SWSPy在剪切波分裂和各向异性研究中展现了显著的优势，特别是在处理高分辨率、大数据集的自动化分析中。通过Teanby等人（2004）提出的多窗口方法和先进的聚类算法，SWSPy为单个源接收器测量提供了稳定且可靠的结果。此外，SWSPy实现了三维剪切波分裂测量（Walsh等，2013），使其能够在没有显著速度梯度的环境下有效地进行各向异性测量，这对于钻孔数据或类似设置尤为重要。</p>
</li>
<li>
<p>针对包含大量源接收器对的大规模数据集，SWSPy提供了完全自动化的工作流程，其模块化的Python包架构使得工作流程可以灵活适应各种研究需求。SWSPy能够处理成千上万甚至百万级的剪切波分裂测量数据，这一能力为各向异性层析成像的研究提供了重要支持，能够显著增加观测数据的数量，进而降低层析成像中固有的不充分约束问题（Chevrot et al., 2004）。同时，SWSPy提供了多种质量评估指标（如QW和λ2/λ1）以及不确定性测量（如αφ，αδt），使得用户能够有效地过滤虚假结果，提高分析的可靠性。</p>
</li>
<li>
<p>尽管SWSPy在多层各向异性测量中具有强大的功能，但其局限性也不可忽视。首先，进行多层分析时，需要满足特定的假设条件，特别是在信号频率和各向异性强度之间的关系较为复杂时，SWSPy的多层方法可能不适用。对于此类数据集，必须谨慎应用该方法，并仔细考虑假设条件。其次，尽管不确定性测量对于去除虚假结果至关重要，但在某些情况下，这些测量可能低估了实际的不确定性。因此，未来的研究应当着重于改进测量质量指标和更准确地估算不确定性。</p>
</li>
<li>
<p>此外，SWSPy使用Python编写，这一面向对象的语言相对于C或Julia等低级语言而言，计算速度较慢。为了减少这一限制，SWSPy通过numba进行加速，成功并行化了计算密集型的函数。尽管通过使用更底层语言可以进一步提高效率，但为了提高软件的可访问性和易用性，SWSPy并未采用这种方案。随着现代计算机性能的提升，SWSPy的并行化优化有效地弥补了性能瓶颈。</p>
</li>
</ul>
<h3>4.2 剪切波分裂的其他应用</h3>
<ul>
<li>
<p>剪切波分裂的应用不仅限于地下各向异性成像，其在其他领域也有重要的应用。一个有价值但未充分利用的参数是S波源极化。S波源极化可以为断层方位提供独立的测量，特别是在双偶极源的情况下（Hudson等，2023）。此外，剪切波分裂的另一个重要成果是各向异性修正波形，这对于使用各向同性模型进行全波形反演非常重要，尤其是在反演地震源机制时（Hudson等，2020a）。新提出的多层方法将进一步减少多层各向异性介质传播的地震波数据与各向同性全波形模型之间的误差，提供更加精确的反演结果。</p>
</li>
<li>
<p>剪切波分裂的另一个应用是在计算地震震级时去除分裂效应。剪切波分裂可能导致S波相位重叠和互相干扰，改变表观频率内容，从而增加矩震级计算中的不确定性（Stork等，2014）。将剪切波分裂修正方法轻松融入矩震级计算流程，能够减少震级目录中的不确定性，进而有助于改进地震监测（Schultz等，2021）。</p>
</li>
</ul>
<p><a href="https://seismica.library.mcgill.ca/article/view/1031" rel="nofollow">Paper link</a><br>
[Github  project address]（<a href="https://github.com/TomSHudson/swspy%EF%BC%89">https://github.com/TomSHudson/swspy）</a></p></div>
<div style="font-size:small;margin-top:8px;float:right;">转载请注明出处</div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://Lszidv.github.io">芜尽</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行 "+diffDay+" 天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.disabled=true;
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","Lszidv/Lszidv.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
<script>MathJax = {tex: {inlineMath: [["$", "$"]]}};</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</html>
